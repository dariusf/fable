
(executable
 (name web)
 (modules web)
 (libraries brr fabula)
 (modes js))

(rule
  (with-stdout-to embedded.ml
    (progn
      (echo "let index = {|")
      ; (cat index.html)
      (run sed s@_build/default/web.bc.js@runtime.js@ index.html)
      (echo "|}")
      (echo "let runtime = {|")
      (cat web.bc.js)
      (echo "|}")
      (echo "let interpret = {|")
      (cat interpret.js)
      (echo "|}")
      )))

(executable
 (name fable)
 (public_name fable)
 (modules fable embedded)
 (libraries fabula)
 (preprocess (pps ppx_deriving_yojson ppx_deriving.std)))

(env (dev (flags (:standard -warn-error -A))))